<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>23&nbsp; Reshaping Data with melt() and pivot() – Introduction to Data Science with Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./p_ai_LLM_functions.html" rel="next">
<link href="./p_untangled_joining_2.html" rel="prev">
<link href="./logo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script type="text/javascript">
window.PlotlyConfig = {MathJaxConfig: 'local'};
if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
if (typeof require !== 'undefined') {
require.undef("plotly");
requirejs.config({
    paths: {
        'plotly': ['https://cdn.plot.ly/plotly-2.35.2.min']
    }
});
require(['plotly'], function(Plotly) {
    window._Plotly = Plotly;
});
}
</script>



<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./p_untangled_subset_columns.html">Data Manipulation</a></li><li class="breadcrumb-item"><a href="./p_untangled_pivoting.html"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Reshaping Data with melt() and pivot()</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Data Science with Python</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/the-graph-courses/idap_book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">介绍</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_foundations_google_colab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Google Colab</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_foundations_coding_basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Coding basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_foundations_functions_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Functions, Methods, and Libraries in Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_foundations_data_structures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Structures in Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_foundations_for_loops.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Intro to Loops in Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_foundations_writing_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Intro to Functions and Conditionals</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Visualization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_data_on_display_data_viz_types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data Visualization Types</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_data_on_display_univariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Univariate Graphs with Plotly Express</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_data_on_display_multivariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Bivariate &amp; Multivariate Graphs with Plotly Express</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Tools for Local Python</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_tools_installing_python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Installing Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_tools_using_vscode.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Installing and Using VS Code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_tools_venv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Folders and Virtual Environments</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_tools_quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Using Quarto</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Manipulation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_subset_columns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Subsetting columns</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_query_rows.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Querying rows</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_transform_variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Transforming Variables in pandas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_conditional_transforms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Conditional Transformations of Variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_groupby_agg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Grouping and summarizing data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_other_grouped_operations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Other Grouped Operations in Pandas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_joining_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Introduction to Joining Datasets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_joining_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Joining 2: One-to-Many, Multi-Key Joins &amp; Key Mismatches</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_pivoting.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Reshaping Data with melt() and pivot()</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Using LLMs in Python</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_ai_LLM_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Using LLMs in Python for Text Generation</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#packages" id="toc-packages" class="nav-link active" data-scroll-target="#packages"><span class="header-section-number">23.1</span> Packages</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span class="header-section-number">23.2</span> Data</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">23.3</span> Introduction</a></li>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives"><span class="header-section-number">23.4</span> Learning Objectives</a></li>
  <li><a href="#what-do-wide-and-long-mean" id="toc-what-do-wide-and-long-mean" class="nav-link" data-scroll-target="#what-do-wide-and-long-mean"><span class="header-section-number">23.5</span> What Do “Wide” and “Long” Mean?</a></li>
  <li><a href="#when-should-you-use-wide-vs.-long-data" id="toc-when-should-you-use-wide-vs.-long-data" class="nav-link" data-scroll-target="#when-should-you-use-wide-vs.-long-data"><span class="header-section-number">23.7</span> When Should You Use Wide vs.&nbsp;Long Data?</a></li>
  <li><a href="#from-wide-to-long-with-melt" id="toc-from-wide-to-long-with-melt" class="nav-link" data-scroll-target="#from-wide-to-long-with-melt"><span class="header-section-number">23.8</span> From Wide to Long with <code>melt()</code></a></li>
  <li><a href="#using-long-data-for-analysis" id="toc-using-long-data-for-analysis" class="nav-link" data-scroll-target="#using-long-data-for-analysis"><span class="header-section-number">23.11</span> Using Long Data for Analysis</a></li>
  <li><a href="#from-long-to-wide" id="toc-from-long-to-wide" class="nav-link" data-scroll-target="#from-long-to-wide"><span class="header-section-number">23.12</span> From Long to Wide</a></li>
  <li><a href="#reshaping-can-be-hard" id="toc-reshaping-can-be-hard" class="nav-link" data-scroll-target="#reshaping-can-be-hard"><span class="header-section-number">23.15</span> Reshaping Can Be Hard</a></li>
  <li><a href="#wrap-up" id="toc-wrap-up" class="nav-link" data-scroll-target="#wrap-up"><span class="header-section-number">23.16</span> Wrap-Up</a></li>
  <li><a href="#solution-q-wide-or-long" id="toc-solution-q-wide-or-long" class="nav-link" data-scroll-target="#solution-q-wide-or-long"><span class="header-section-number">23.17</span> Solution Q: Wide or Long?</a></li>
  <li><a href="#solution-q-temperatures-to-long" id="toc-solution-q-temperatures-to-long" class="nav-link" data-scroll-target="#solution-q-temperatures-to-long"><span class="header-section-number">23.18</span> Solution Q: Temperatures to Long</a></li>
  <li><a href="#solution-q-eurostat-births-to-long" id="toc-solution-q-eurostat-births-to-long" class="nav-link" data-scroll-target="#solution-q-eurostat-births-to-long"><span class="header-section-number">23.19</span> Solution Q: Eurostat Births to Long</a></li>
  <li><a href="#solution-q-temperatures-back-to-wide" id="toc-solution-q-temperatures-back-to-wide" class="nav-link" data-scroll-target="#solution-q-temperatures-back-to-wide"><span class="header-section-number">23.20</span> Solution Q: Temperatures back to Wide</a></li>
  <li><a href="#solution-q-population-to-wide" id="toc-solution-q-population-to-wide" class="nav-link" data-scroll-target="#solution-q-population-to-wide"><span class="header-section-number">23.21</span> Solution Q: Population to Wide</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/the-graph-courses/idap_book/edit/main/p_untangled_pivoting.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/the-graph-courses/idap_book/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./p_untangled_subset_columns.html">Data Manipulation</a></li><li class="breadcrumb-item"><a href="./p_untangled_pivoting.html"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Reshaping Data with melt() and pivot()</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Reshaping Data with melt() and pivot()</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="packages" class="level2" data-number="23.1">
<h2 data-number="23.1" class="anchored" data-anchor-id="packages"><span class="header-section-number">23.1</span> Packages</h2>
<div id="d2c7e1ca" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data" class="level2" data-number="23.2">
<h2 data-number="23.2" class="anchored" data-anchor-id="data"><span class="header-section-number">23.2</span> Data</h2>
<p>Run the code below to load and define the datasets to be used in this lesson.</p>
<div id="5820b1cc" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperatures dataset</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>temperatures <span class="op">=</span> pd.DataFrame(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"country"</span>: [<span class="st">"Sweden"</span>, <span class="st">"Denmark"</span>, <span class="st">"Norway"</span>],</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"1994"</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>],</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"1995"</span>: [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>],</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"1996"</span>: [<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>],</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Fuels Wide dataset</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>fuels_wide <span class="op">=</span> pd.read_csv(</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://raw.githubusercontent.com/the-graph-courses/idap_book/main/data/oil_per_capita_wide.csv"</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Eurostat Births Wide dataset</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>euro_births_wide <span class="op">=</span> pd.read_csv(</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://raw.githubusercontent.com/the-graph-courses/idap_book/main/data/euro_births_wide.csv"</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Contracts dataset</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>contracts <span class="op">=</span> pd.read_csv(</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://raw.githubusercontent.com/the-graph-courses/idap_book/main/data/chicago_contracts_20_23.csv"</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Population dataset</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>population <span class="op">=</span> pd.read_csv(</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://raw.githubusercontent.com/the-graph-courses/idap_book/main/data/tidyr_population.csv"</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="introduction" class="level2" data-number="23.3">
<h2 data-number="23.3" class="anchored" data-anchor-id="introduction"><span class="header-section-number">23.3</span> Introduction</h2>
<p>Reshaping is a data manipulation technique that involves re-orienting the rows and columns of a dataset. This is often required to make data easier to analyze or understand.</p>
<p>In this lesson, we will cover how to effectively reshape data using <code>pandas</code> functions.</p>
</section>
<section id="learning-objectives" class="level2" data-number="23.4">
<h2 data-number="23.4" class="anchored" data-anchor-id="learning-objectives"><span class="header-section-number">23.4</span> Learning Objectives</h2>
<ul>
<li>Understand what wide data format is and what long data format is.</li>
<li>Learn how to reshape wide data to long data using <code>melt()</code>.</li>
<li>Learn how to reshape long data to wide data using <code>pivot()</code>.</li>
</ul>
</section>
<section id="what-do-wide-and-long-mean" class="level2" data-number="23.5">
<h2 data-number="23.5" class="anchored" data-anchor-id="what-do-wide-and-long-mean"><span class="header-section-number">23.5</span> What Do “Wide” and “Long” Mean?</h2>
<p>The terms “wide” and “long” are best understood in the context of example datasets. Let’s take a look at some now.</p>
<p>Imagine that you have three products for which you collect sales data over three months.</p>
<p><strong>Wide Format:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Product</th>
<th>Jan</th>
<th>Feb</th>
<th>Mar</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>100</td>
<td>120</td>
<td>110</td>
</tr>
<tr class="even">
<td>B</td>
<td>90</td>
<td>95</td>
<td>100</td>
</tr>
<tr class="odd">
<td>C</td>
<td>80</td>
<td>85</td>
<td>90</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>Long Format:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Product</th>
<th>Month</th>
<th>Sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>Jan</td>
<td>100</td>
</tr>
<tr class="even">
<td>A</td>
<td>Feb</td>
<td>120</td>
</tr>
<tr class="odd">
<td>A</td>
<td>Mar</td>
<td>110</td>
</tr>
<tr class="even">
<td>B</td>
<td>Jan</td>
<td>90</td>
</tr>
<tr class="odd">
<td>B</td>
<td>Feb</td>
<td>95</td>
</tr>
<tr class="even">
<td>B</td>
<td>Mar</td>
<td>100</td>
</tr>
<tr class="odd">
<td>C</td>
<td>Jan</td>
<td>80</td>
</tr>
<tr class="even">
<td>C</td>
<td>Feb</td>
<td>85</td>
</tr>
<tr class="odd">
<td>C</td>
<td>Mar</td>
<td>90</td>
</tr>
</tbody>
</table>
<p>Take a minute to study the two datasets to make sure you understand the relationship between them.</p>
<p>In the <strong>wide dataset</strong>, each observational unit (each product) occupies only one row, and each measurement (sales in Jan, Feb, Mar) is in a separate column.</p>
<p>In the <strong>long dataset</strong>, on the other hand, each observational unit (each product) occupies multiple rows, with one row for each measurement.</p>
<hr>
<p>Here’s another example with mock data, where the observational units are countries:</p>
<p><strong>Long Format:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Country</th>
<th>Year</th>
<th>GDP</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>USA</td>
<td>2020</td>
<td>21433</td>
</tr>
<tr class="even">
<td>USA</td>
<td>2021</td>
<td>22940</td>
</tr>
<tr class="odd">
<td>China</td>
<td>2020</td>
<td>14723</td>
</tr>
<tr class="even">
<td>China</td>
<td>2021</td>
<td>17734</td>
</tr>
</tbody>
</table>
<p><strong>Wide Format:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Country</th>
<th>GDP_2020</th>
<th>GDP_2021</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>USA</td>
<td>21433</td>
<td>22940</td>
</tr>
<tr class="even">
<td>China</td>
<td>14723</td>
<td>17734</td>
</tr>
</tbody>
</table>
<hr>
<p>The examples above are both time-series datasets because the measurements are repeated across time. But the concepts of wide and long are relevant to other kinds of data too.</p>
<p>Consider the example below, showing the number of employees in different departments of three companies:</p>
<p><strong>Wide Format:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Company</th>
<th>HR</th>
<th>Sales</th>
<th>IT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>10</td>
<td>20</td>
<td>15</td>
</tr>
<tr class="even">
<td>B</td>
<td>8</td>
<td>25</td>
<td>20</td>
</tr>
<tr class="odd">
<td>C</td>
<td>12</td>
<td>18</td>
<td>22</td>
</tr>
</tbody>
</table>
<p><strong>Long Format:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Company</th>
<th>Department</th>
<th>Employees</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>HR</td>
<td>10</td>
</tr>
<tr class="even">
<td>A</td>
<td>Sales</td>
<td>20</td>
</tr>
<tr class="odd">
<td>A</td>
<td>IT</td>
<td>15</td>
</tr>
<tr class="even">
<td>B</td>
<td>HR</td>
<td>8</td>
</tr>
<tr class="odd">
<td>B</td>
<td>Sales</td>
<td>25</td>
</tr>
<tr class="even">
<td>B</td>
<td>IT</td>
<td>20</td>
</tr>
<tr class="odd">
<td>C</td>
<td>HR</td>
<td>12</td>
</tr>
<tr class="even">
<td>C</td>
<td>Sales</td>
<td>18</td>
</tr>
<tr class="odd">
<td>C</td>
<td>IT</td>
<td>22</td>
</tr>
</tbody>
</table>
<p>In the wide dataset, each observational unit (each company) occupies only one row, with the repeated measurements (number of employees in different departments) spread across multiple columns.</p>
<p>In the long dataset, each observational unit is spread over multiple rows.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Vocab">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Vocab
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong>observational units</strong>, sometimes called <strong>statistical units</strong>, are the primary entities or items described by the dataset.</p>
<p>In the first example, the observational units were products; in the second example, countries; and in the third example, companies.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<section id="practice-q-wide-or-long" class="level2 callout-body-container callout-body" data-number="23.6">
<h2 data-number="23.6" class="anchored" data-anchor-id="practice-q-wide-or-long"><span class="header-section-number">23.6</span> Practice Q: Wide or Long?</h2>
<p>Consider the <code>temperatures</code> dataset created earlier:</p>
<div id="53000a83" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>temperatures</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">1994</th>
<th data-quarto-table-cell-role="th">1995</th>
<th data-quarto-table-cell-role="th">1996</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Sweden</td>
<td>1</td>
<td>3</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Denmark</td>
<td>2</td>
<td>4</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Norway</td>
<td>3</td>
<td>5</td>
<td>7</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Is this data in a wide or long format?</p>
</section>
</div>
</section>
<section id="when-should-you-use-wide-vs.-long-data" class="level2" data-number="23.7">
<h2 data-number="23.7" class="anchored" data-anchor-id="when-should-you-use-wide-vs.-long-data"><span class="header-section-number">23.7</span> When Should You Use Wide vs.&nbsp;Long Data?</h2>
<p>The truth is, it really depends on what you want to do! The wide format is great for <em>displaying data</em> because it’s easy to visually compare values this way. Long data is best for some data analysis tasks, like grouping and plotting.</p>
<p>It is essential to know how to switch from one format to the other easily. Switching from the wide to the long format, or the other way around, is called <strong>reshaping</strong>.</p>
</section>
<section id="from-wide-to-long-with-melt" class="level2" data-number="23.8">
<h2 data-number="23.8" class="anchored" data-anchor-id="from-wide-to-long-with-melt"><span class="header-section-number">23.8</span> From Wide to Long with <code>melt()</code></h2>
<p>To practice reshaping from a wide to a long format, we’ll consider data from Our World in Data on fossil fuel consumption per capita. You can find the data <a href="https://ourworldindata.org/grapher/fossil-fuels-per-capita">here</a>.</p>
<p>Below, we view this data on fossil fuel consumption per capita:</p>
<div id="593f2fae" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>fuels_wide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Entity</th>
<th data-quarto-table-cell-role="th">Code</th>
<th data-quarto-table-cell-role="th">y_1970</th>
<th data-quarto-table-cell-role="th">y_1980</th>
<th data-quarto-table-cell-role="th">y_1990</th>
<th data-quarto-table-cell-role="th">y_2000</th>
<th data-quarto-table-cell-role="th">y_2010</th>
<th data-quarto-table-cell-role="th">y_2020</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Algeria</td>
<td>DZA</td>
<td>1764.8470</td>
<td>3532.7976</td>
<td>4381.6636</td>
<td>3351.2180</td>
<td>5064.9863</td>
<td>4877.2680</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Argentina</td>
<td>ARG</td>
<td>11677.9680</td>
<td>10598.3990</td>
<td>7046.2485</td>
<td>7146.8154</td>
<td>7966.7827</td>
<td>6399.2114</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Australia</td>
<td>AUS</td>
<td>23040.4550</td>
<td>25007.4380</td>
<td>23046.9510</td>
<td>23976.3550</td>
<td>23584.3070</td>
<td>20332.4100</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Austria</td>
<td>AUT</td>
<td>14338.8090</td>
<td>19064.0920</td>
<td>16595.1930</td>
<td>18189.0920</td>
<td>18424.1170</td>
<td>14934.0650</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Azerbaijan</td>
<td>AZE</td>
<td>NaN</td>
<td>NaN</td>
<td>13516.0190</td>
<td>9119.3470</td>
<td>4031.9407</td>
<td>5615.1157</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">76</td>
<td>United States</td>
<td>USA</td>
<td>40813.9530</td>
<td>42365.6500</td>
<td>37525.5160</td>
<td>37730.1600</td>
<td>31791.3070</td>
<td>26895.4770</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">77</td>
<td>Uzbekistan</td>
<td>UZB</td>
<td>NaN</td>
<td>NaN</td>
<td>6324.8677</td>
<td>3197.1330</td>
<td>1880.1338</td>
<td>1859.1548</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">78</td>
<td>Venezuela</td>
<td>VEN</td>
<td>11138.2210</td>
<td>16234.0960</td>
<td>12404.5570</td>
<td>11239.9260</td>
<td>14948.3070</td>
<td>4742.6226</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">79</td>
<td>Vietnam</td>
<td>VNM</td>
<td>1757.6117</td>
<td>439.9465</td>
<td>523.2565</td>
<td>1280.3065</td>
<td>2296.7590</td>
<td>2927.7446</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">80</td>
<td>World</td>
<td>OWID_WRL</td>
<td>7217.8340</td>
<td>8002.0854</td>
<td>7074.2583</td>
<td>6990.4272</td>
<td>6879.6110</td>
<td>6216.8060</td>
</tr>
</tbody>
</table>

<p>81 rows × 8 columns</p>
</div>
</div>
</div>
<p>We observe that each observational unit (each country) occupies only one row, with the repeated measurements of fossil fuel consumption (in kilowatt-hour equivalents) spread out across multiple columns. Hence, this dataset is in a wide format.</p>
<p>To convert it to a long format, we can use the convenient <code>melt</code> function. Within <code>melt</code>, can define the id variables, which we do not want to reshape:</p>
<div id="b02c2ccd" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>fuels_long <span class="op">=</span> fuels_wide.melt(id_vars<span class="op">=</span>[<span class="st">"Entity"</span>, <span class="st">"Code"</span>])</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>fuels_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Entity</th>
<th data-quarto-table-cell-role="th">Code</th>
<th data-quarto-table-cell-role="th">variable</th>
<th data-quarto-table-cell-role="th">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Algeria</td>
<td>DZA</td>
<td>y_1970</td>
<td>1764.8470</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Argentina</td>
<td>ARG</td>
<td>y_1970</td>
<td>11677.9680</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Australia</td>
<td>AUS</td>
<td>y_1970</td>
<td>23040.4550</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Austria</td>
<td>AUT</td>
<td>y_1970</td>
<td>14338.8090</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Azerbaijan</td>
<td>AZE</td>
<td>y_1970</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">481</td>
<td>United States</td>
<td>USA</td>
<td>y_2020</td>
<td>26895.4770</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">482</td>
<td>Uzbekistan</td>
<td>UZB</td>
<td>y_2020</td>
<td>1859.1548</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">483</td>
<td>Venezuela</td>
<td>VEN</td>
<td>y_2020</td>
<td>4742.6226</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">484</td>
<td>Vietnam</td>
<td>VNM</td>
<td>y_2020</td>
<td>2927.7446</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">485</td>
<td>World</td>
<td>OWID_WRL</td>
<td>y_2020</td>
<td>6216.8060</td>
</tr>
</tbody>
</table>

<p>486 rows × 4 columns</p>
</div>
</div>
</div>
<p>Very easy!</p>
<p>Let’s sort it so it’s easier to read:</p>
<div id="a7a33391" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>fuels_long <span class="op">=</span> fuels_long.sort_values(by<span class="op">=</span>[<span class="st">'Entity'</span>, <span class="st">'variable'</span>])</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>fuels_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Entity</th>
<th data-quarto-table-cell-role="th">Code</th>
<th data-quarto-table-cell-role="th">variable</th>
<th data-quarto-table-cell-role="th">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Algeria</td>
<td>DZA</td>
<td>y_1970</td>
<td>1764.8470</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">81</td>
<td>Algeria</td>
<td>DZA</td>
<td>y_1980</td>
<td>3532.7976</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">162</td>
<td>Algeria</td>
<td>DZA</td>
<td>y_1990</td>
<td>4381.6636</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">243</td>
<td>Algeria</td>
<td>DZA</td>
<td>y_2000</td>
<td>3351.2180</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">324</td>
<td>Algeria</td>
<td>DZA</td>
<td>y_2010</td>
<td>5064.9863</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">161</td>
<td>World</td>
<td>OWID_WRL</td>
<td>y_1980</td>
<td>8002.0854</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">242</td>
<td>World</td>
<td>OWID_WRL</td>
<td>y_1990</td>
<td>7074.2583</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">323</td>
<td>World</td>
<td>OWID_WRL</td>
<td>y_2000</td>
<td>6990.4272</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">404</td>
<td>World</td>
<td>OWID_WRL</td>
<td>y_2010</td>
<td>6879.6110</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">485</td>
<td>World</td>
<td>OWID_WRL</td>
<td>y_2020</td>
<td>6216.8060</td>
</tr>
</tbody>
</table>

<p>486 rows × 4 columns</p>
</div>
</div>
</div>
<p>The years are now indicated in the variable <code>variable</code>, and all the consumption values occupy a single variable, <code>value</code>. We may wish to rename the <code>variable</code> column to <code>year</code>, and the <code>value</code> column to <code>oil_consumption</code>. This can be done directly in the <code>melt</code> function:</p>
<div id="a9b7e009" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>fuels_long <span class="op">=</span> fuels_wide.melt(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    id_vars<span class="op">=</span>[<span class="st">'Entity'</span>, <span class="st">'Code'</span>],</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    var_name<span class="op">=</span><span class="st">'year'</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    value_name<span class="op">=</span><span class="st">'oil_consumption'</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>).sort_values(by<span class="op">=</span>[<span class="st">'Entity'</span>, <span class="st">'year'</span>])</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>fuels_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Entity</th>
<th data-quarto-table-cell-role="th">Code</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">oil_consumption</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Algeria</td>
<td>DZA</td>
<td>y_1970</td>
<td>1764.8470</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">81</td>
<td>Algeria</td>
<td>DZA</td>
<td>y_1980</td>
<td>3532.7976</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">162</td>
<td>Algeria</td>
<td>DZA</td>
<td>y_1990</td>
<td>4381.6636</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">243</td>
<td>Algeria</td>
<td>DZA</td>
<td>y_2000</td>
<td>3351.2180</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">324</td>
<td>Algeria</td>
<td>DZA</td>
<td>y_2010</td>
<td>5064.9863</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">161</td>
<td>World</td>
<td>OWID_WRL</td>
<td>y_1980</td>
<td>8002.0854</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">242</td>
<td>World</td>
<td>OWID_WRL</td>
<td>y_1990</td>
<td>7074.2583</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">323</td>
<td>World</td>
<td>OWID_WRL</td>
<td>y_2000</td>
<td>6990.4272</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">404</td>
<td>World</td>
<td>OWID_WRL</td>
<td>y_2010</td>
<td>6879.6110</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">485</td>
<td>World</td>
<td>OWID_WRL</td>
<td>y_2020</td>
<td>6216.8060</td>
</tr>
</tbody>
</table>

<p>486 rows × 4 columns</p>
</div>
</div>
</div>
<p>You may also want to remove the <code>y_</code> in front of each year. This can be achieved with a string operation.</p>
<div id="08704fb2" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fuels_long[<span class="st">'year'</span>] <span class="op">=</span> fuels_long[<span class="st">'year'</span>].<span class="bu">str</span>.replace(<span class="st">'y_'</span>, <span class="st">''</span>).astype(<span class="bu">int</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>fuels_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Entity</th>
<th data-quarto-table-cell-role="th">Code</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">oil_consumption</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Algeria</td>
<td>DZA</td>
<td>1970</td>
<td>1764.8470</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">81</td>
<td>Algeria</td>
<td>DZA</td>
<td>1980</td>
<td>3532.7976</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">162</td>
<td>Algeria</td>
<td>DZA</td>
<td>1990</td>
<td>4381.6636</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">243</td>
<td>Algeria</td>
<td>DZA</td>
<td>2000</td>
<td>3351.2180</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">324</td>
<td>Algeria</td>
<td>DZA</td>
<td>2010</td>
<td>5064.9863</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">161</td>
<td>World</td>
<td>OWID_WRL</td>
<td>1980</td>
<td>8002.0854</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">242</td>
<td>World</td>
<td>OWID_WRL</td>
<td>1990</td>
<td>7074.2583</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">323</td>
<td>World</td>
<td>OWID_WRL</td>
<td>2000</td>
<td>6990.4272</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">404</td>
<td>World</td>
<td>OWID_WRL</td>
<td>2010</td>
<td>6879.6110</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">485</td>
<td>World</td>
<td>OWID_WRL</td>
<td>2020</td>
<td>6216.8060</td>
</tr>
</tbody>
</table>

<p>486 rows × 4 columns</p>
</div>
</div>
</div>
<p>Here’s what we did above:</p>
<ul>
<li>Used <code>str.replace()</code> to remove the <code>y_</code> prefix from each year.</li>
<li>Converted the <code>year</code> column to integers using <code>astype(int)</code>.</li>
<li>Sorted the data by “Entity” and “year” using <code>sort_values()</code>.</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<section id="practice-q-temperatures-to-long" class="level2 callout-body-container callout-body" data-number="23.9">
<h2 data-number="23.9" class="anchored" data-anchor-id="practice-q-temperatures-to-long"><span class="header-section-number">23.9</span> Practice Q: Temperatures to Long</h2>
<p>Convert the <code>temperatures</code> dataset shown below into a long format. Your answer should have the following column names: <strong>“country”</strong>, <strong>“year”</strong>, and <strong>“avg_temp”</strong>.</p>
<div id="c2ab1ff4" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>temperatures</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">1994</th>
<th data-quarto-table-cell-role="th">1995</th>
<th data-quarto-table-cell-role="th">1996</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Sweden</td>
<td>1</td>
<td>3</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Denmark</td>
<td>2</td>
<td>4</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Norway</td>
<td>3</td>
<td>5</td>
<td>7</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<section id="practice-q-eurostat-births-to-long" class="level2 callout-body-container callout-body" data-number="23.10">
<h2 data-number="23.10" class="anchored" data-anchor-id="practice-q-eurostat-births-to-long"><span class="header-section-number">23.10</span> Practice Q: Eurostat Births to Long</h2>
<p>For this practice question, you will use the <code>euro_births_wide</code> dataset from <a href="https://ec.europa.eu/eurostat/databrowser/view/tps00204/default/table">Eurostat</a>. It shows the annual number of births in 50 European countries:</p>
<div id="fe9c9b70" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>euro_births_wide.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">x2015</th>
<th data-quarto-table-cell-role="th">x2016</th>
<th data-quarto-table-cell-role="th">x2017</th>
<th data-quarto-table-cell-role="th">x2018</th>
<th data-quarto-table-cell-role="th">x2019</th>
<th data-quarto-table-cell-role="th">x2020</th>
<th data-quarto-table-cell-role="th">x2021</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Belgium</td>
<td>122274.0</td>
<td>121896.0</td>
<td>119690.0</td>
<td>118319.0</td>
<td>117695.0</td>
<td>114350.0</td>
<td>118349.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Bulgaria</td>
<td>65950.0</td>
<td>64984.0</td>
<td>63955.0</td>
<td>62197.0</td>
<td>61538.0</td>
<td>59086.0</td>
<td>58678.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Czechia</td>
<td>110764.0</td>
<td>112663.0</td>
<td>114405.0</td>
<td>114036.0</td>
<td>112231.0</td>
<td>110200.0</td>
<td>111793.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Denmark</td>
<td>58205.0</td>
<td>61614.0</td>
<td>61397.0</td>
<td>61476.0</td>
<td>61167.0</td>
<td>60937.0</td>
<td>63473.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Germany</td>
<td>737575.0</td>
<td>792141.0</td>
<td>784901.0</td>
<td>787523.0</td>
<td>778090.0</td>
<td>773144.0</td>
<td>795492.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The data is in a wide format. Convert it to a long format DataFrame that has the following column names: <strong>“country”</strong>, <strong>“year”</strong>, and <strong>“births_count”</strong>.</p>
<p>Remove the x prefix from the year columns and convert them to integers.</p>
</section>
</div>
</section>
<section id="using-long-data-for-analysis" class="level2" data-number="23.11">
<h2 data-number="23.11" class="anchored" data-anchor-id="using-long-data-for-analysis"><span class="header-section-number">23.11</span> Using Long Data for Analysis</h2>
<p>Let’s see why long data is often better for analysis.</p>
<p>Consider again the <code>fuels_wide</code> dataset:</p>
<div id="451aba37" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fuels_wide.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Entity</th>
<th data-quarto-table-cell-role="th">Code</th>
<th data-quarto-table-cell-role="th">y_1970</th>
<th data-quarto-table-cell-role="th">y_1980</th>
<th data-quarto-table-cell-role="th">y_1990</th>
<th data-quarto-table-cell-role="th">y_2000</th>
<th data-quarto-table-cell-role="th">y_2010</th>
<th data-quarto-table-cell-role="th">y_2020</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Algeria</td>
<td>DZA</td>
<td>1764.847</td>
<td>3532.7976</td>
<td>4381.6636</td>
<td>3351.2180</td>
<td>5064.9863</td>
<td>4877.2680</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Argentina</td>
<td>ARG</td>
<td>11677.968</td>
<td>10598.3990</td>
<td>7046.2485</td>
<td>7146.8154</td>
<td>7966.7827</td>
<td>6399.2114</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Australia</td>
<td>AUS</td>
<td>23040.455</td>
<td>25007.4380</td>
<td>23046.9510</td>
<td>23976.3550</td>
<td>23584.3070</td>
<td>20332.4100</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Austria</td>
<td>AUT</td>
<td>14338.809</td>
<td>19064.0920</td>
<td>16595.1930</td>
<td>18189.0920</td>
<td>18424.1170</td>
<td>14934.0650</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Azerbaijan</td>
<td>AZE</td>
<td>NaN</td>
<td>NaN</td>
<td>13516.0190</td>
<td>9119.3470</td>
<td>4031.9407</td>
<td>5615.1157</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="e553098e" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fuels_long.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Entity</th>
<th data-quarto-table-cell-role="th">Code</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">oil_consumption</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Algeria</td>
<td>DZA</td>
<td>1970</td>
<td>1764.8470</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">81</td>
<td>Algeria</td>
<td>DZA</td>
<td>1980</td>
<td>3532.7976</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">162</td>
<td>Algeria</td>
<td>DZA</td>
<td>1990</td>
<td>4381.6636</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">243</td>
<td>Algeria</td>
<td>DZA</td>
<td>2000</td>
<td>3351.2180</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">324</td>
<td>Algeria</td>
<td>DZA</td>
<td>2010</td>
<td>5064.9863</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>If we want to find the average fossil fuel consumption per country, this is very easy to do with the long format:</p>
<div id="22557695" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>fuels_long.groupby(<span class="st">'Entity'</span>)[<span class="st">'oil_consumption'</span>].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>Entity
Algeria           3828.796750
Argentina         8472.570833
Australia        23164.652667
Austria          16924.228000
Azerbaijan        8070.605600
                     ...     
United States    36187.010500
Uzbekistan        3315.322325
Venezuela        11784.621600
Vietnam           1537.604133
World             7063.503650
Name: oil_consumption, Length: 81, dtype: float64</code></pre>
</div>
</div>
<p>But with the wide format, this is not so easy:</p>
<div id="bc71019f" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fuels_wide[[<span class="st">'y_1970'</span>, <span class="st">'y_1980'</span>, <span class="st">'y_1990'</span>, <span class="st">'y_2000'</span>, <span class="st">'y_2010'</span>, <span class="st">'y_2020'</span>]].mean(axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>0      3828.796750
1      8472.570833
2     23164.652667
3     16924.228000
4      8070.605600
          ...     
76    36187.010500
77     3315.322325
78    11784.621600
79     1537.604133
80     7063.503650
Length: 81, dtype: float64</code></pre>
</div>
</div>
<p>Imagine if you had 100 years of data!</p>
<p>And mean is a fairly simple operation. How would you calculate the standard deviation of fossil fuel consumption per country?</p>
<hr>
<p>Long data is also very useful for plotting.</p>
<p>For example, to plot the average fossil fuel consumption per country over time, we can use the following code:</p>
<div id="b1d1f192" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>subset <span class="op">=</span> fuels_long.query(<span class="st">'Entity in ["Peru", "Iran", "China"]'</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>px.line(subset, x<span class="op">=</span><span class="st">'year'</span>, y<span class="op">=</span><span class="st">'oil_consumption'</span>, color<span class="op">=</span><span class="st">'Entity'</span>, title<span class="op">=</span><span class="st">'Average Fossil Fuel Consumption per Country'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>                            <div id="18e5d370-f965-43e8-87c9-176510d563d8" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("18e5d370-f965-43e8-87c9-176510d563d8")) {                    Plotly.newPlot(                        "18e5d370-f965-43e8-87c9-176510d563d8",                        [{"hovertemplate":"Entity=China\u003cbr\u003eyear=%{x}\u003cbr\u003eoil_consumption=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"China","line":{"color":"#636efa","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"China","orientation":"v","showlegend":true,"x":[1970,1980,1990,2000,2010,2020],"xaxis":"x","y":[403.68585,989.9839,1104.7654,2078.0774,3867.767,5586.006],"yaxis":"y","type":"scatter"},{"hovertemplate":"Entity=Iran\u003cbr\u003eyear=%{x}\u003cbr\u003eoil_consumption=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Iran","line":{"color":"#EF553B","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Iran","orientation":"v","showlegend":true,"x":[1970,1980,1990,2000,2010,2020],"xaxis":"x","y":[4541.2197,8574.222,9915.312,11834.9,12530.483,10509.824],"yaxis":"y","type":"scatter"},{"hovertemplate":"Entity=Peru\u003cbr\u003eyear=%{x}\u003cbr\u003eoil_consumption=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Peru","line":{"color":"#00cc96","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Peru","orientation":"v","showlegend":true,"x":[1970,1980,1990,2000,2010,2020],"xaxis":"x","y":[4195.2544,4450.3794,3150.43,3315.4153,3473.1367,3212.9465],"yaxis":"y","type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"year"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"oil_consumption"}},"legend":{"title":{"text":"Entity"},"tracegroupgap":0},"title":{"text":"Average Fossil Fuel Consumption per Country"}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('18e5d370-f965-43e8-87c9-176510d563d8');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>To create a plot like this with the wide format is not directly possible, since the data you want to plot is scattered across multiple columns.</p>
<p>So as you can see, while wide data is great for display, long data is very useful for analysis and plotting.</p>
</section>
<section id="from-long-to-wide" class="level2" data-number="23.12">
<h2 data-number="23.12" class="anchored" data-anchor-id="from-long-to-wide"><span class="header-section-number">23.12</span> From Long to Wide</h2>
<p>Now you know how to reshape from wide to long with <code>melt()</code>. How about going the other way, from long to wide? For this, you can use the <code>pivot()</code> function.</p>
<p>But before we see how to use this function to manipulate long data, let’s first consider <em>where</em> you’re likely to run into long data.</p>
<p>While wide data tends to come from external sources (as we have seen above), long data, on the other hand, is likely to be created by <em>you</em> while data wrangling, especially in the course of grouped aggregations.</p>
<p>Let’s see an example of this now.</p>
<p>We will use a dataset of contracts granted by the city of Chicago from 2020 to 2023. You can find more information about the data <a href="https://data.cityofchicago.org/Administration-Finance/Contracts/rsxa-ify5/">here</a>.</p>
<div id="d90b2ea2" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>contracts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">approval_date</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">contract_num</th>
<th data-quarto-table-cell-role="th">revision_num</th>
<th data-quarto-table-cell-role="th">specification_num</th>
<th data-quarto-table-cell-role="th">contract_type</th>
<th data-quarto-table-cell-role="th">start_date</th>
<th data-quarto-table-cell-role="th">end_date</th>
<th data-quarto-table-cell-role="th">department</th>
<th data-quarto-table-cell-role="th">vendor_name</th>
<th data-quarto-table-cell-role="th">vendor_id</th>
<th data-quarto-table-cell-role="th">address_1</th>
<th data-quarto-table-cell-role="th">address_2</th>
<th data-quarto-table-cell-role="th">city</th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">zip</th>
<th data-quarto-table-cell-role="th">award_amount</th>
<th data-quarto-table-cell-role="th">procurement_type</th>
<th data-quarto-table-cell-role="th">contract_pdf</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2020</td>
<td>2020-01-02</td>
<td>LEASE</td>
<td>24406</td>
<td>32</td>
<td>96136</td>
<td>PROPERTY LEASE</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>8700 BUILDING LLC</td>
<td>89123305A</td>
<td>7300 S NARRAGANSETT</td>
<td>NaN</td>
<td>BEDFORD PARK</td>
<td>Illinois</td>
<td>60638</td>
<td>321.1</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2020</td>
<td>2020-01-03</td>
<td>DFSS-HHS-CS-CEL:</td>
<td>113798</td>
<td>0</td>
<td>1070196</td>
<td>DELEGATE AGENCY</td>
<td>12/01/2019</td>
<td>11/30/2022</td>
<td>DEPT OF FAMILY AND SUPPORT SERVICES</td>
<td>CATHOLIC CHARITIES OF THE ARCHDIOCESE OF CHICAGO</td>
<td>102484615A</td>
<td>1 E BANKS ST</td>
<td>NaN</td>
<td>CHICAGO</td>
<td>Illinois</td>
<td>60670</td>
<td>17692515.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2020</td>
<td>2020-01-03</td>
<td>DFSS-HHS-CS-CEL:</td>
<td>113819</td>
<td>0</td>
<td>1070196</td>
<td>DELEGATE AGENCY</td>
<td>12/01/2019</td>
<td>11/30/2022</td>
<td>DEPT OF FAMILY AND SUPPORT SERVICES</td>
<td>KIMBALL DAYCARE CENTER &amp; KINDERGARTEN INC</td>
<td>105458567Z</td>
<td>1636-1638 N KIMBALL AVE</td>
<td>NaN</td>
<td>CHICAGO</td>
<td>Illinois</td>
<td>60647</td>
<td>11461500.0</td>
<td>NaN</td>
<td>http://ecm.cityofchicago.org/eSMARTContracts/s...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2020</td>
<td>2020-01-03</td>
<td>DFSS-HHS-CS-CEL:</td>
<td>113818</td>
<td>0</td>
<td>1070196</td>
<td>DELEGATE AGENCY</td>
<td>12/01/2019</td>
<td>11/30/2022</td>
<td>DEPT OF FAMILY AND SUPPORT SERVICES</td>
<td>JUDAH INTERNATIONAL OUTREACH MINISTRIES, INC</td>
<td>94219962X</td>
<td>856 N PULASKI RD</td>
<td>NaN</td>
<td>CHICAGO</td>
<td>Illinois</td>
<td>60651</td>
<td>2356515.0</td>
<td>NaN</td>
<td>http://ecm.cityofchicago.org/eSMARTContracts/s...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2020</td>
<td>2020-01-03</td>
<td>DFSS-HHS-CS-CEL:</td>
<td>113820</td>
<td>0</td>
<td>1070196</td>
<td>DELEGATE AGENCY</td>
<td>12/01/2019</td>
<td>11/30/2022</td>
<td>DEPT OF FAMILY AND SUPPORT SERVICES</td>
<td>Marillac St. Vincent Family Services Inc DBA S...</td>
<td>97791861L</td>
<td>212 S FRANCISCO AVENUE EFT</td>
<td>NaN</td>
<td>CHICAGO</td>
<td>Illinois</td>
<td>60612</td>
<td>3666015.0</td>
<td>NaN</td>
<td>http://ecm.cityofchicago.org/eSMARTContracts/s...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28823</td>
<td>2023</td>
<td>2023-12-29</td>
<td>DFSS-CORP-HL-PSH:</td>
<td>220413</td>
<td>3</td>
<td>1221503</td>
<td>DELEGATE AGENCY</td>
<td>NaN</td>
<td>NaN</td>
<td>DEPT OF FAMILY AND SUPPORT SERVICES</td>
<td>INNER VOICE INC.</td>
<td>6231926M</td>
<td>1621 W WALNUT ST FL 1ST</td>
<td>NaN</td>
<td>CHICAGO</td>
<td>Illinois</td>
<td>60612</td>
<td>0.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">28824</td>
<td>2023</td>
<td>2023-12-29</td>
<td>DFSS-CORP-YS-OST:</td>
<td>253846</td>
<td>0</td>
<td>1247493</td>
<td>DELEGATE AGENCY</td>
<td>NaN</td>
<td>NaN</td>
<td>DEPT OF FAMILY AND SUPPORT SERVICES</td>
<td>AFTER-SCHOOL MATTERS, INC.|CLEANED-UP</td>
<td>72580818P</td>
<td>66 E RANDOLPH ST FL 1ST</td>
<td>NaN</td>
<td>CHICAGO</td>
<td>Illinois</td>
<td>60601</td>
<td>32000.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28825</td>
<td>2023</td>
<td>2023-12-29</td>
<td>DFSS-IDHS-HL-INTHS:</td>
<td>253843</td>
<td>0</td>
<td>1235949</td>
<td>DELEGATE AGENCY</td>
<td>NaN</td>
<td>NaN</td>
<td>DEPT OF FAMILY AND SUPPORT SERVICES</td>
<td>BREAKTHROUGH URBAN MINISTRIES, INC.</td>
<td>94722896V</td>
<td>402 N ST LOUIS AVENUE EFT</td>
<td>NaN</td>
<td>CHICAGO</td>
<td>Illinois</td>
<td>60624</td>
<td>14400.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">28826</td>
<td>2023</td>
<td>2023-12-29</td>
<td>CDPH-RW-PA: ESS-HRSA PO 116685 CHICAGO HOUSE A...</td>
<td>192085</td>
<td>1</td>
<td>1095441</td>
<td>DELEGATE AGENCY</td>
<td>NaN</td>
<td>NaN</td>
<td>DEPARTMENT OF HEALTH</td>
<td>CHICAGO HOUSE &amp; SOCIAL SERVICE AGENCY</td>
<td>105470138T</td>
<td>2229 S MICHIGAN AVE 304 EFT</td>
<td>NaN</td>
<td>CHICAGO</td>
<td>Illinois</td>
<td>60616</td>
<td>-32025.2</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28827</td>
<td>2023</td>
<td>2023-12-29</td>
<td>DFSS-HHS-CS-CEL:</td>
<td>222199</td>
<td>1</td>
<td>1070196</td>
<td>DELEGATE AGENCY</td>
<td>NaN</td>
<td>NaN</td>
<td>DEPT OF FAMILY AND SUPPORT SERVICES</td>
<td>ALLISON'S INFANT &amp; TODDLER CENTER INC</td>
<td>62751817Z</td>
<td>234 E 115TH ST FL 1ST</td>
<td>NaN</td>
<td>CHICAGO</td>
<td>Illinois</td>
<td>60628</td>
<td>141923.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>28828 rows × 20 columns</p>
</div>
</div>
</div>
<p>Each row corresponds to one contract, and we have each contract’s ID number, the year in which it was granted, the amount of the contract, and the vendor’s name and address, among other variables.</p>
<p>Now, consider the following grouped summary of the <code>contracts</code> dataset, which shows the number of contracts by state of the vendor in each year:</p>
<div id="83ac2205" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>contracts_summary <span class="op">=</span> contracts.groupby(<span class="st">"state"</span>)[<span class="st">"year"</span>].value_counts().reset_index()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>contracts_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Alabama</td>
<td>2023</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Alabama</td>
<td>2021</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Alabama</td>
<td>2020</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Alabama</td>
<td>2022</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Arizona</td>
<td>2020</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">128</td>
<td>Washington</td>
<td>2021</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">129</td>
<td>Wisconsin</td>
<td>2023</td>
<td>25</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">130</td>
<td>Wisconsin</td>
<td>2020</td>
<td>18</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">131</td>
<td>Wisconsin</td>
<td>2022</td>
<td>17</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">132</td>
<td>Wisconsin</td>
<td>2021</td>
<td>15</td>
</tr>
</tbody>
</table>

<p>133 rows × 3 columns</p>
</div>
</div>
</div>
<p>The output of this grouped operation is a quintessentially “long” dataset. Each observational unit (each state) occupies multiple rows, with one row for each measurement (each year).</p>
<p>Now, let’s see how to convert such long data into a wide format with <code>pivot()</code>.</p>
<p>The code is quite straightforward:</p>
<div id="1a96c0d4" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>contracts_wide <span class="op">=</span> contracts_summary.pivot(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">"state"</span>, columns<span class="op">=</span><span class="st">"year"</span>, values<span class="op">=</span><span class="st">"count"</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>contracts_wide.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">2020</th>
<th data-quarto-table-cell-role="th">2021</th>
<th data-quarto-table-cell-role="th">2022</th>
<th data-quarto-table-cell-role="th">2023</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Alabama</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>7.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Arizona</td>
<td>3.0</td>
<td>1.0</td>
<td>3.0</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Arkansas</td>
<td>1.0</td>
<td>NaN</td>
<td>1.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>British Columbia</td>
<td>NaN</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>California</td>
<td>36.0</td>
<td>42.0</td>
<td>43.0</td>
<td>38.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>As you can see, <code>pivot()</code> has three important arguments:</p>
<ul>
<li><strong><code>index</code></strong> defines which column(s) to use as the new index. In our case, it’s the “state” since we want each row to represent one state.</li>
<li><strong><code>columns</code></strong> identifies which variable to use to define column names in the wide format. In our case, it’s the “year”. You can see that the years are now the column names.</li>
<li><strong><code>values</code></strong> specifies which values will become the core of the wide data format. In our case, it’s the number of contracts “count”.</li>
</ul>
<p>You might also want to have the <em>years</em> be your primary observational units, with each year occupying one row. This can be carried out similarly to the above example, but with <code>year</code> as the index and <code>state</code> as the columns:</p>
<div id="d822fdd6" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>contracts_wide_year <span class="op">=</span> contracts_summary.pivot(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">"year"</span>, columns<span class="op">=</span><span class="st">"state"</span>, values<span class="op">=</span><span class="st">"count"</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>contracts_wide_year</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">Alabama</th>
<th data-quarto-table-cell-role="th">Arizona</th>
<th data-quarto-table-cell-role="th">Arkansas</th>
<th data-quarto-table-cell-role="th">British Columbia</th>
<th data-quarto-table-cell-role="th">California</th>
<th data-quarto-table-cell-role="th">Canada</th>
<th data-quarto-table-cell-role="th">Colorado</th>
<th data-quarto-table-cell-role="th">Connecticut</th>
<th data-quarto-table-cell-role="th">Delaware</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Oregon</th>
<th data-quarto-table-cell-role="th">Pennsylvania</th>
<th data-quarto-table-cell-role="th">Rhode Island</th>
<th data-quarto-table-cell-role="th">South Carolina</th>
<th data-quarto-table-cell-role="th">Tennessee</th>
<th data-quarto-table-cell-role="th">Texas</th>
<th data-quarto-table-cell-role="th">Vermont</th>
<th data-quarto-table-cell-role="th">Virginia</th>
<th data-quarto-table-cell-role="th">Washington</th>
<th data-quarto-table-cell-role="th">Wisconsin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2020</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>NaN</td>
<td>36.0</td>
<td>1.0</td>
<td>6.0</td>
<td>1.0</td>
<td>NaN</td>
<td>...</td>
<td>5.0</td>
<td>20.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>25.0</td>
<td>NaN</td>
<td>4.0</td>
<td>NaN</td>
<td>18.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2021</td>
<td>2.0</td>
<td>1.0</td>
<td>NaN</td>
<td>1.0</td>
<td>42.0</td>
<td>1.0</td>
<td>2.0</td>
<td>5.0</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>24.0</td>
<td>NaN</td>
<td>3.0</td>
<td>2.0</td>
<td>24.0</td>
<td>1.0</td>
<td>4.0</td>
<td>1.0</td>
<td>15.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2022</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>NaN</td>
<td>43.0</td>
<td>1.0</td>
<td>7.0</td>
<td>3.0</td>
<td>1.0</td>
<td>...</td>
<td>NaN</td>
<td>31.0</td>
<td>NaN</td>
<td>2.0</td>
<td>3.0</td>
<td>37.0</td>
<td>NaN</td>
<td>7.0</td>
<td>NaN</td>
<td>17.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2023</td>
<td>7.0</td>
<td>2.0</td>
<td>NaN</td>
<td>NaN</td>
<td>38.0</td>
<td>NaN</td>
<td>6.0</td>
<td>5.0</td>
<td>2.0</td>
<td>...</td>
<td>NaN</td>
<td>37.0</td>
<td>NaN</td>
<td>1.0</td>
<td>3.0</td>
<td>28.0</td>
<td>NaN</td>
<td>9.0</td>
<td>NaN</td>
<td>25.0</td>
</tr>
</tbody>
</table>

<p>4 rows × 44 columns</p>
</div>
</div>
</div>
<p>Here, the unique observation units (our rows) are now the years (2020, 2021, 2022, 2023).</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<section id="practice-q-temperatures-back-to-wide" class="level2 callout-body-container callout-body" data-number="23.13">
<h2 data-number="23.13" class="anchored" data-anchor-id="practice-q-temperatures-back-to-wide"><span class="header-section-number">23.13</span> Practice Q: Temperatures back to Wide</h2>
<p>Convert the long <code>temperatures_long</code> dataset you created above back to a wide format. Your answer should have the following column names: <strong>“country”</strong>, <strong>“1994”</strong>, <strong>“1995”</strong>, and <strong>“1996”</strong>.</p>
<div id="fa8023b9" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<section id="practice-q-population-to-wide" class="level2 callout-body-container callout-body" data-number="23.14">
<h2 data-number="23.14" class="anchored" data-anchor-id="practice-q-population-to-wide"><span class="header-section-number">23.14</span> Practice Q: Population to Wide</h2>
<p>The <code>population</code> dataset shows the populations of 219 countries over time.</p>
<p>Reshape this data into a wide format.</p>
<div id="203d70ef" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>population</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">population</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Afghanistan</td>
<td>1995</td>
<td>17586073</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Afghanistan</td>
<td>1996</td>
<td>18415307</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Afghanistan</td>
<td>1997</td>
<td>19021226</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Afghanistan</td>
<td>1998</td>
<td>19496836</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Afghanistan</td>
<td>1999</td>
<td>19987071</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4040</td>
<td>Zimbabwe</td>
<td>2009</td>
<td>12888918</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4041</td>
<td>Zimbabwe</td>
<td>2010</td>
<td>13076978</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4042</td>
<td>Zimbabwe</td>
<td>2011</td>
<td>13358738</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4043</td>
<td>Zimbabwe</td>
<td>2012</td>
<td>13724317</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4044</td>
<td>Zimbabwe</td>
<td>2013</td>
<td>14149648</td>
</tr>
</tbody>
</table>

<p>4045 rows × 3 columns</p>
</div>
</div>
</div>
</section>
</div>
</section>
<section id="reshaping-can-be-hard" class="level2" data-number="23.15">
<h2 data-number="23.15" class="anchored" data-anchor-id="reshaping-can-be-hard"><span class="header-section-number">23.15</span> Reshaping Can Be Hard</h2>
<p>We have mostly looked at very simple examples of reshaping here, but in the wild, reshaping can be difficult to do accurately.</p>
<p>When you run into such cases, we recommend looking at the <a href="https://pandas.pydata.org/docs/user_guide/reshaping.html">official documentation</a> of reshaping from the pandas team, as it is quite rich in examples.</p>
</section>
<section id="wrap-up" class="level2" data-number="23.16">
<h2 data-number="23.16" class="anchored" data-anchor-id="wrap-up"><span class="header-section-number">23.16</span> Wrap-Up</h2>
<p>Congratulations! You’ve gotten the hang of reshaping data with pandas.</p>
<p>You now understand the differences between wide and long formats and can skillfully use <code>melt()</code> and <code>pivot()</code> to transform your data as needed.</p>
</section>
<section id="solution-q-wide-or-long" class="level2" data-number="23.17">
<h2 data-number="23.17" class="anchored" data-anchor-id="solution-q-wide-or-long"><span class="header-section-number">23.17</span> Solution Q: Wide or Long?</h2>
<p>The data is in a wide format.</p>
</section>
<section id="solution-q-temperatures-to-long" class="level2" data-number="23.18">
<h2 data-number="23.18" class="anchored" data-anchor-id="solution-q-temperatures-to-long"><span class="header-section-number">23.18</span> Solution Q: Temperatures to Long</h2>
<div id="af04f258" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Melt the wide data into long format</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>temperatures_long <span class="op">=</span> temperatures.melt(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    id_vars<span class="op">=</span>[<span class="st">"country"</span>], var_name<span class="op">=</span><span class="st">"year"</span>, value_name<span class="op">=</span><span class="st">"avgtemp"</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the long format data</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>temperatures_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">avgtemp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Sweden</td>
<td>1994</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Denmark</td>
<td>1994</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Norway</td>
<td>1994</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Sweden</td>
<td>1995</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Denmark</td>
<td>1995</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Norway</td>
<td>1995</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Sweden</td>
<td>1996</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Denmark</td>
<td>1996</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Norway</td>
<td>1996</td>
<td>7</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="solution-q-eurostat-births-to-long" class="level2" data-number="23.19">
<h2 data-number="23.19" class="anchored" data-anchor-id="solution-q-eurostat-births-to-long"><span class="header-section-number">23.19</span> Solution Q: Eurostat Births to Long</h2>
<div id="85063c92" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Melt the wide data into long format</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>births_long <span class="op">=</span> euro_births_wide.melt(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    id_vars<span class="op">=</span>[<span class="st">"country"</span>], var_name<span class="op">=</span><span class="st">"year"</span>, value_name<span class="op">=</span><span class="st">"births_count"</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the long format data</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>births_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">births_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Belgium</td>
<td>x2015</td>
<td>122274.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Bulgaria</td>
<td>x2015</td>
<td>65950.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Czechia</td>
<td>x2015</td>
<td>110764.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Denmark</td>
<td>x2015</td>
<td>58205.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Germany</td>
<td>x2015</td>
<td>737575.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">345</td>
<td>Ukraine</td>
<td>x2021</td>
<td>212.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">346</td>
<td>Armenia</td>
<td>x2021</td>
<td>271983.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">347</td>
<td>Azerbaijan</td>
<td>x2021</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">348</td>
<td>Georgia</td>
<td>x2021</td>
<td>112284.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">349</td>
<td>NaN</td>
<td>x2021</td>
<td>45946.0</td>
</tr>
</tbody>
</table>

<p>350 rows × 3 columns</p>
</div>
</div>
</div>
</section>
<section id="solution-q-temperatures-back-to-wide" class="level2" data-number="23.20">
<h2 data-number="23.20" class="anchored" data-anchor-id="solution-q-temperatures-back-to-wide"><span class="header-section-number">23.20</span> Solution Q: Temperatures back to Wide</h2>
<div id="9a48fb48" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot the long data into wide format</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>temperatures_wide <span class="op">=</span> temperatures_long.pivot(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">"country"</span>, columns<span class="op">=</span><span class="st">"year"</span>, values<span class="op">=</span><span class="st">"avgtemp"</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the wide format data</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>temperatures_wide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">1994</th>
<th data-quarto-table-cell-role="th">1995</th>
<th data-quarto-table-cell-role="th">1996</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Denmark</td>
<td>2</td>
<td>4</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Norway</td>
<td>3</td>
<td>5</td>
<td>7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Sweden</td>
<td>1</td>
<td>3</td>
<td>5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="solution-q-population-to-wide" class="level2" data-number="23.21">
<h2 data-number="23.21" class="anchored" data-anchor-id="solution-q-population-to-wide"><span class="header-section-number">23.21</span> Solution Q: Population to Wide</h2>
<div id="af28acc0" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot the long data into wide format</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>population_wide <span class="op">=</span> population.pivot(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">"country"</span>, columns<span class="op">=</span><span class="st">"year"</span>, values<span class="op">=</span><span class="st">"population"</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the wide format data</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>population_wide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">1995</th>
<th data-quarto-table-cell-role="th">1996</th>
<th data-quarto-table-cell-role="th">1997</th>
<th data-quarto-table-cell-role="th">1998</th>
<th data-quarto-table-cell-role="th">1999</th>
<th data-quarto-table-cell-role="th">2000</th>
<th data-quarto-table-cell-role="th">2001</th>
<th data-quarto-table-cell-role="th">2002</th>
<th data-quarto-table-cell-role="th">2003</th>
<th data-quarto-table-cell-role="th">2004</th>
<th data-quarto-table-cell-role="th">2005</th>
<th data-quarto-table-cell-role="th">2006</th>
<th data-quarto-table-cell-role="th">2007</th>
<th data-quarto-table-cell-role="th">2008</th>
<th data-quarto-table-cell-role="th">2009</th>
<th data-quarto-table-cell-role="th">2010</th>
<th data-quarto-table-cell-role="th">2011</th>
<th data-quarto-table-cell-role="th">2012</th>
<th data-quarto-table-cell-role="th">2013</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Afghanistan</td>
<td>17586073.0</td>
<td>18415307.0</td>
<td>19021226.0</td>
<td>19496836.0</td>
<td>19987071.0</td>
<td>20595360.0</td>
<td>21347782.0</td>
<td>22202806.0</td>
<td>23116142.0</td>
<td>24018682.0</td>
<td>24860855.0</td>
<td>25631282.0</td>
<td>26349243.0</td>
<td>27032197.0</td>
<td>27708187.0</td>
<td>28397812.0</td>
<td>29105480.0</td>
<td>29824536.0</td>
<td>30551674.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Albania</td>
<td>3357858.0</td>
<td>3341043.0</td>
<td>3331317.0</td>
<td>3325456.0</td>
<td>3317941.0</td>
<td>3304948.0</td>
<td>3286084.0</td>
<td>3263596.0</td>
<td>3239385.0</td>
<td>3216197.0</td>
<td>3196130.0</td>
<td>3179573.0</td>
<td>3166222.0</td>
<td>3156608.0</td>
<td>3151185.0</td>
<td>3150143.0</td>
<td>3153883.0</td>
<td>3162083.0</td>
<td>3173271.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Algeria</td>
<td>29315463.0</td>
<td>29845208.0</td>
<td>30345466.0</td>
<td>30820435.0</td>
<td>31276295.0</td>
<td>31719449.0</td>
<td>32150198.0</td>
<td>32572977.0</td>
<td>33003442.0</td>
<td>33461345.0</td>
<td>33960903.0</td>
<td>34507214.0</td>
<td>35097043.0</td>
<td>35725377.0</td>
<td>36383302.0</td>
<td>37062820.0</td>
<td>37762962.0</td>
<td>38481705.0</td>
<td>39208194.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>American Samoa</td>
<td>52874.0</td>
<td>53926.0</td>
<td>54942.0</td>
<td>55899.0</td>
<td>56768.0</td>
<td>57522.0</td>
<td>58176.0</td>
<td>58729.0</td>
<td>59117.0</td>
<td>59262.0</td>
<td>59117.0</td>
<td>58652.0</td>
<td>57919.0</td>
<td>57053.0</td>
<td>56245.0</td>
<td>55636.0</td>
<td>55274.0</td>
<td>55128.0</td>
<td>55165.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Andorra</td>
<td>63854.0</td>
<td>64274.0</td>
<td>64090.0</td>
<td>63799.0</td>
<td>64084.0</td>
<td>65399.0</td>
<td>68000.0</td>
<td>71639.0</td>
<td>75643.0</td>
<td>79060.0</td>
<td>81223.0</td>
<td>81877.0</td>
<td>81292.0</td>
<td>79969.0</td>
<td>78659.0</td>
<td>77907.0</td>
<td>77865.0</td>
<td>78360.0</td>
<td>79218.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">212</td>
<td>Wallis and Futuna Islands</td>
<td>14143.0</td>
<td>14221.0</td>
<td>14309.0</td>
<td>14394.0</td>
<td>14460.0</td>
<td>14497.0</td>
<td>14501.0</td>
<td>14476.0</td>
<td>14422.0</td>
<td>14344.0</td>
<td>14246.0</td>
<td>14126.0</td>
<td>13988.0</td>
<td>13840.0</td>
<td>13697.0</td>
<td>13565.0</td>
<td>13451.0</td>
<td>13353.0</td>
<td>13272.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">213</td>
<td>West Bank and Gaza Strip</td>
<td>2598393.0</td>
<td>2722497.0</td>
<td>2851993.0</td>
<td>2980563.0</td>
<td>3099951.0</td>
<td>3204572.0</td>
<td>3291620.0</td>
<td>3363542.0</td>
<td>3426549.0</td>
<td>3489743.0</td>
<td>3559856.0</td>
<td>3638829.0</td>
<td>3725076.0</td>
<td>3817551.0</td>
<td>3914035.0</td>
<td>4012880.0</td>
<td>4114199.0</td>
<td>4218771.0</td>
<td>4326295.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">214</td>
<td>Yemen</td>
<td>15018201.0</td>
<td>15578640.0</td>
<td>16088019.0</td>
<td>16564235.0</td>
<td>17035531.0</td>
<td>17522537.0</td>
<td>18029989.0</td>
<td>18551068.0</td>
<td>19081306.0</td>
<td>19612696.0</td>
<td>20139661.0</td>
<td>20661714.0</td>
<td>21182162.0</td>
<td>21703571.0</td>
<td>22229625.0</td>
<td>22763008.0</td>
<td>23304206.0</td>
<td>23852409.0</td>
<td>24407381.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">215</td>
<td>Zambia</td>
<td>8841338.0</td>
<td>9073311.0</td>
<td>9320089.0</td>
<td>9577483.0</td>
<td>9839179.0</td>
<td>10100981.0</td>
<td>10362137.0</td>
<td>10625423.0</td>
<td>10894519.0</td>
<td>11174650.0</td>
<td>11470022.0</td>
<td>11781612.0</td>
<td>12109620.0</td>
<td>12456527.0</td>
<td>12825031.0</td>
<td>13216985.0</td>
<td>13633796.0</td>
<td>14075099.0</td>
<td>14538640.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">216</td>
<td>Zimbabwe</td>
<td>11639364.0</td>
<td>11846110.0</td>
<td>12045813.0</td>
<td>12229500.0</td>
<td>12384727.0</td>
<td>12503652.0</td>
<td>12586763.0</td>
<td>12640922.0</td>
<td>12673103.0</td>
<td>12693047.0</td>
<td>12710589.0</td>
<td>12724308.0</td>
<td>12740160.0</td>
<td>12784041.0</td>
<td>12888918.0</td>
<td>13076978.0</td>
<td>13358738.0</td>
<td>13724317.0</td>
<td>14149648.0</td>
</tr>
</tbody>
</table>

<p>217 rows × 20 columns</p>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./p_untangled_joining_2.html" class="pagination-link" aria-label="Joining 2: One-to-Many, Multi-Key Joins &amp; Key Mismatches">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Joining 2: One-to-Many, Multi-Key Joins &amp; Key Mismatches</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./p_ai_LLM_functions.html" class="pagination-link" aria-label="Using LLMs in Python for Text Generation">
        <span class="nav-page-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Using LLMs in Python for Text Generation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Book created by <a href="https://thegraphcourses.org/">The GRAPH Courses</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/the-graph-courses/idap_book/edit/main/p_untangled_pivoting.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/the-graph-courses/idap_book/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>