---
title: 'å˜é‡çš„æ¡ä»¶æ€§è½¬æ¢'
---

```{python}
# | echo: false
# Setup
import pandas as pd
import numpy as np
pd.options.display.max_rows = 7
```

## ä»‹ç»

åœ¨ä¸Šä¸€è¯¾ä¸­,ä½ å­¦ä¹ äº† pandas ä¸­æ•°æ®è½¬æ¢çš„åŸºç¡€çŸ¥è¯†ã€‚

åœ¨æœ¬è¯¾ä¸­,æˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•ä½¿ç”¨ `replace()` å’Œè‡ªå®šä¹‰å‡½æ•°ç­‰æ–¹æ³•åœ¨ pandas ä¸­**æ¡ä»¶æ€§åœ°è½¬æ¢å˜é‡**ã€‚

æ¡ä»¶æ€§è½¬æ¢åœ¨ä½ éœ€è¦æ ¹æ®ç‰¹å®šæ¡ä»¶é‡æ–°ç¼–ç å˜é‡æˆ–åˆ›å»ºæ–°å˜é‡æ—¶éå¸¸é‡è¦ã€‚

è®©æˆ‘ä»¬å¼€å§‹å§!

## å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬è¯¾å,ä½ å°†èƒ½å¤Ÿ:

- ä½¿ç”¨ `replace()` å’Œå­—å…¸æ ¹æ®æ¡ä»¶è½¬æ¢æˆ–åˆ›å»ºæ–°å˜é‡ã€‚
- çŸ¥é“å¦‚ä½•åœ¨ `replace()` è½¬æ¢ä¸­å¤„ç† `NaN` å€¼ã€‚
- èƒ½å¤Ÿå®šä¹‰å’Œåº”ç”¨è‡ªå®šä¹‰å‡½æ•°æ¥é‡æ–°ç¼–ç å˜é‡ã€‚

## åŒ…

æœ¬è¯¾å°†éœ€è¦ `pandas`ã€`numpy`ã€`plotly.express` å’Œ `vega_datasets`:

```{python}
import pandas as pd
import numpy as np
import vega_datasets as vd
import plotly.express as px
```

## `replace()` ç®€ä»‹

æ•°æ®æ•´ç†ä¸­çš„ä¸€ä¸ªå¸¸è§ä»»åŠ¡æ˜¯æ ¹æ®æŸäº›æ¡ä»¶æ›¿æ¢åˆ—ä¸­çš„å€¼ã€‚pandas ä¸­çš„ `replace()` æ–¹æ³•æ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½çš„å·¥å…·ã€‚

åœ¨ `tips` æ•°æ®é›†ä¸­,`day` åˆ—åŒ…å«ç®€å†™çš„æ˜ŸæœŸåç§°:

```{python}
tips = px.data.tips()
tips['day'].unique()
```

æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç”¨å®Œæ•´çš„æ˜ŸæœŸåç§°æ›¿æ¢è¿™äº›ç¼©å†™ã€‚

æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå°†ç¼©å†™åç§°æ˜ å°„åˆ°å®Œæ•´åç§°çš„å­—å…¸:

```{python}
day_mapping = {
    "Sun": "Sunday",
    "Sat": "Saturday",
    "Fri": "Friday",
    "Thur": "Thursday"
}
```

ç°åœ¨,æˆ‘ä»¬ä½¿ç”¨å¸¦æœ‰å­—å…¸çš„ `replace()` æ–¹æ³•:

```{python}
tips['day_full'] = tips['day'].replace(day_mapping)
tips
```

æˆ–è€…,æˆ‘ä»¬å¯ä»¥åœ¨ `replace()` æ–¹æ³•ä¸­ç›´æ¥è¿›è¡Œæ›¿æ¢,è€Œæ— éœ€æ˜ç¡®åœ°å®šä¹‰å­—å…¸:

```{python}
tips['day_full'] = tips['day'].replace({
    "Sun": "Sunday",
    "Sat": "Saturday",
    "Fri": "Friday",
    "Thur": "Thursday"
})
tips[['day', 'day_full']].head()
```

::: {.callout-tip title="ç»ƒä¹ "}

## ç»ƒä¹ é¢˜:ç¼©å†™æ€§åˆ«

ä½¿ç”¨ `tips` æ•°æ®é›†,å°† `sex` åˆ—ä¸­çš„å€¼ç¼©å†™æ€§åˆ«:

- å°† `"Female"` æ›¿æ¢ä¸º `"F"`ã€‚
- å°† `"Male"` æ›¿æ¢ä¸º `"M"`ã€‚

å°†ç»“æœèµ‹å€¼ç»™ä¸€ä¸ªåä¸º `sex_abbr` çš„æ–°åˆ—å¹¶æ˜¾ç¤ºå‰å‡ è¡Œã€‚

```{python}
# Your code here:
```

:::

## ä½¿ç”¨ `replace()` å¤„ç†ç¼ºå¤±å€¼

æœ‰æ—¶,ä½ çš„æ•°æ®é›†ä¸­å¯èƒ½åŒ…å«ç¼ºå¤±å€¼(`NaN` æˆ– `None`),ä½ å¸Œæœ›ç”¨å ä½ç¬¦æˆ–ç‰¹å®šå€¼æ›¿æ¢å®ƒä»¬ã€‚`replace()` æ–¹æ³•å¯ä»¥å¤„ç†è¿™ç§æƒ…å†µã€‚

è®©æˆ‘ä»¬æ£€æŸ¥ vega_datasets ä¸­ `movies` æ•°æ®é›†çš„ `Creative_Type` åˆ—:

```{python}
movies = vd.data.movies()
movies['Creative_Type'].value_counts(dropna=False)
```

æ³¨æ„ `Creative_Type` åˆ—ä¸­æœ‰ä¸€äº› `None` å€¼ã€‚

è®©æˆ‘ä»¬å°† `None` æ›¿æ¢ä¸º `"Unknown/Unclear"`:

```{python}
movies['Creative_Type'] = movies['Creative_Type'].replace({
    None: "Unknown/Unclear", # ğŸ‘ˆ åœ¨è¿™ä¸€è¡Œ,None æ˜¯é”®
})
```

ç°åœ¨,è®©æˆ‘ä»¬éªŒè¯æ›¿æ¢:

```{python}
movies['Creative_Type'].value_counts(dropna=False)
```

è™½ç„¶ `None` é€šå¸¸ç”¨äºè¡¨ç¤ºç¼ºå¤±çš„å­—ç¬¦ä¸²,`NaN` ç”¨äºè¡¨ç¤ºç¼ºå¤±çš„æ•°å­—ã€‚è€ƒè™‘ `US_DVD_Sales` åˆ—:

```{python}
movies.query("US_DVD_Sales.isna()").shape # æ£€æŸ¥ç¼ºå¤±å€¼çš„æ•°é‡
```

```{python}
movies['US_DVD_Sales'].tail(10) # æŸ¥çœ‹æœ€å 10 ä¸ªå€¼ã€‚æœ‰äº›ç¼ºå¤±ã€‚
```

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `replace()` å°† `NaN` æ›¿æ¢ä¸º 0:

```{python}
movies['US_DVD_Sales'] = movies['US_DVD_Sales'].replace({
    np.nan: 0 # ğŸ‘ˆ pandas ä¸­ç”¨ `np.nan` è¡¨ç¤º `NaN`
})
```

è®©æˆ‘ä»¬éªŒè¯æ›¿æ¢:

```{python}
movies['US_DVD_Sales'].tail(10)
```

```{python}
movies.query("US_DVD_Sales.isna()").shape
```

::: {.callout-practice title="ç»ƒä¹ "}

## ç»ƒä¹ é¢˜:æ ‡å‡†åŒ– MPAA åˆ†çº§

åœ¨ `movies` æ•°æ®é›†ä¸­,`MPAA_Rating` åˆ—åŒ…å«ç”µå½±åˆ†çº§ã€‚æœ‰äº›æ¡ç›®æ˜¯ `None` æˆ– `"Not Rated"`ã€‚å°† `None` å’Œ `"Not Rated"` éƒ½æ›¿æ¢ä¸º `"Unrated"`ã€‚

ç„¶å,ä½¿ç”¨ `value_counts()` æŸ¥çœ‹æœ‰å¤šå°‘ç”µå½±æœªåˆ†çº§ã€‚è¯¥ç±»åˆ«ä¸‹åº”è¯¥æœ‰ 699 éƒ¨ç”µå½±ã€‚

```{python}
# Your code here:

```

:::

## ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°å¯¹æ•°å€¼æ•°æ®åˆ†ç±»

å›æƒ³æˆ‘ä»¬ä¸Šä¸€è¯¾çš„å†…å®¹,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¸¦æœ‰æ¡ä»¶é€»è¾‘çš„è‡ªå®šä¹‰å‡½æ•°æ¥è½¬æ¢å˜é‡ã€‚ä¾‹å¦‚,æˆ‘ä»¬å¯ä»¥æ ¹æ®ä»¥ä¸‹æ ‡å‡†å°† `US_Gross` åˆ—åˆ†ç±»ä¸ºä¸‰ç±»:

- å¦‚æœå€¼å°äº 1000 ä¸‡,ç±»åˆ«ä¸º `"Low"`ã€‚
- å¦‚æœå€¼åœ¨ 1000 ä¸‡åˆ° 5000 ä¸‡ä¹‹é—´,ç±»åˆ«ä¸º `"Medium"`ã€‚
- å¦‚æœå€¼å¤§äº 5000 ä¸‡,ç±»åˆ«ä¸º `"High"`ã€‚

```{python}
def categ_gross(gross):
    if gross < 10000000:
        return "Low"
    elif gross >= 10000000 and gross <= 50000000:
        return "Medium"
    elif gross > 50000000:
        return "High"
    else:
        return None 


categ_gross_vec = np.vectorize(categ_gross)
```

::: {.callout-note title="é™„æ³¨"}

åœ¨ä¸Šè¿°æƒ…å†µä¸‹,`np.vectorize` å‡½æ•°å°†è¿”å› `None` ä½œä¸ºå­—ç¬¦ä¸²ã€‚ä¸ºäº†å¼ºåˆ¶ä½¿ç”¨ `None` ç±»å‹,ä½ å¯ä»¥ä½¿ç”¨ `otypes` å‚æ•°:

```{python}
categ_gross_vec = np.vectorize(categ_gross, otypes=[object])
```

:::

ç°åœ¨æˆ‘ä»¬å¯ä»¥å°†å…¶åº”ç”¨äºæ•´ä¸ªåˆ—:

```{python}
movies['Gross_Category'] = categ_gross_vec(movies['US_Gross'])
movies['Gross_Category'].value_counts(dropna=False)
```

è¿™ä¹Ÿå¯ä»¥é€šè¿‡ `pd.cut()`ã€`np.where()` å’Œ `np.select()` å®ç°ã€‚ä½†è‡ªå®šä¹‰å‡½æ•°æ–¹æ³•æ˜¯æœ€çµæ´»çš„ã€‚ä¸‹é¢æˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•å°†å…¶æ‰©å±•åˆ°æ›´å¤æ‚çš„æ¡ä»¶ã€‚

## ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°è¿›è¡Œå¤æ‚è½¬æ¢

è‡ªå®šä¹‰å‡½æ•°çš„çµæ´»æ€§å¯ä»¥è½»æ¾æ‰©å±•åˆ°æ›´å¤æ‚çš„æ¡ä»¶è½¬æ¢ã€‚

ä¾‹å¦‚,å‡è®¾æˆ‘ä»¬æƒ³æ ¹æ®ç¾å›½å’Œå…¨çƒçš„æ€»æ”¶å…¥å°†è¶…çº§è‹±é›„ç”µå½±æ ‡è®°ä¸ºâ€œç¾å›½åŠ¨ä½œç”µå½±â€æˆ–â€œå…¨çƒåŠ¨ä½œç”µå½±â€ã€‚

- å¯¹äºè¶…çº§è‹±é›„ç”µå½±,å¦‚æœç¾å›½æ€»æ”¶å…¥å’Œå…¨çƒæ€»æ”¶å…¥ç›¸åŒ(è¡¨æ˜é”€å”®ä»…åœ¨ç¾å›½),åˆ™ç”µå½±è¢«æ ‡è®°ä¸º**ç¾å›½åŠ¨ä½œç”µå½±**ã€‚
- å¯¹äºè¶…çº§è‹±é›„ç”µå½±,å¦‚æœå…¨çƒæ€»æ”¶å…¥å¤§äºç¾å›½æ€»æ”¶å…¥,ç”µå½±è¢«æ ‡è®°ä¸º**å…¨çƒåŠ¨ä½œç”µå½±**ã€‚
- å¯¹äºæ‰€æœ‰å…¶ä»–ç”µå½±,ä¿ç•™ç©ºç™½æ ‡è®°ã€‚

æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæ¥å—ä¸‰ä¸ªå‚æ•°å¹¶è¿”å›é€‚å½“æ ‡è®°çš„å‡½æ•°:

```{python}
# å®šä¹‰æ ¹æ®æ¡ä»¶æ ‡è®°ç”µå½±çš„å‡½æ•°
def flag_movie(movie_type, us, worldwide):
    if movie_type == 'Super Hero' and us == worldwide:
        return 'US action movie'
    elif movie_type == 'Super Hero' and worldwide > us:
        return 'Global action movie'
    else:
        return None
```

è®©æˆ‘ä»¬ç”¨å‡ ä¸ªå€¼é›†æ¥æµ‹è¯•å®ƒ:

```{python}
print(flag_movie(movie_type='Super Hero', us=100, worldwide=100))
print(flag_movie(movie_type='Super Hero', us=100, worldwide=200))
print(flag_movie(movie_type='Comedy', us=100, worldwide=100))
```

ç°åœ¨,è®©æˆ‘ä»¬å°†å…¶å‘é‡åŒ–:

```{python}
flag_movie_vec = np.vectorize(flag_movie)
``` 

æˆ‘ä»¬ç°åœ¨å¯ä»¥å°†å…¶åº”ç”¨åˆ°åˆ—:

```{python}
movies['Action_Flag'] = flag_movie_vec(movies['Creative_Type'], movies['US_Gross'], movies['Worldwide_Gross'])
movies
```

è¦æŸ¥çœ‹åŸºäºæˆ‘ä»¬æ ‡è®°çš„ç”µå½±ç±»åˆ«åˆ†å¸ƒ,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `value_counts()`:

```{python}
movies['Action_Flag'].value_counts(dropna=False)
```

::: {.callout-practice title="ç»ƒä¹ "}

### ç»ƒä¹ :æ ¹æ®è¯„åˆ†æ ‡è®°ç”µå½±

åœ¨ `movies` æ•°æ®é›†ä¸­,æ ¹æ®çƒ‚ç•ªèŒ„(Rotten Tomatoes)å’Œ IMDB è¯„åˆ†å°†ç”µå½±æ ‡è®°ä¸º**å½±è¯„äººå‹å¥½**æˆ–**å•†ä¸šåŒ–**ã€‚

- å¦‚æœçƒ‚ç•ªèŒ„è¯„åˆ†é«˜äº 70% ä¸” IMDB è¯„åˆ†ä½äº 5,ç”µå½±è¢«æ ‡è®°ä¸º**å½±è¯„äººå‹å¥½**ã€‚
- å¦‚æœçƒ‚ç•ªèŒ„è¯„åˆ†ä½äº 50% ä¸” IMDB è¯„åˆ†é«˜äº 7,ç”µå½±è¢«æ ‡è®°ä¸º**å•†ä¸šåŒ–**ã€‚
- å¦åˆ™,ç”µå½±åˆ†ç±»ä¸º**å…¶ä»–**ã€‚
- ç»Ÿè®¡æœ‰å¤šå°‘ç”µå½±æ˜¯**å½±è¯„äººå‹å¥½**å’Œ**å•†ä¸šåŒ–**ã€‚åº”è¯¥æœ‰ 13 éƒ¨å½±è¯„äººå‹å¥½ç”µå½±å’Œ 33 éƒ¨å•†ä¸šåŒ–ç”µå½±ã€‚ä½ è®¤è¯†å…¶ä¸­çš„ä»»ä½•ç”µå½±å—?

```{python}
# Your code here:

```

:::

## æ€»ç»“

åœ¨æœ¬è¯¾ä¸­,ä½ å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•åœ¨ pandas ä¸­æœ‰æ¡ä»¶åœ°è½¬æ¢å˜é‡:

- ä½¿ç”¨å¸¦æœ‰å­—å…¸çš„ `replace()` æ–¹æ³•æ¥æ˜ å°„å’Œæ›¿æ¢ç‰¹å®šå€¼ã€‚
- åœ¨æ›¿æ¢è¿‡ç¨‹ä¸­å¤„ç†ç¼ºå¤±å€¼(`NaN` æˆ– `None`)ã€‚
- å®šä¹‰è‡ªå®šä¹‰å‡½æ•°å¹¶åº”ç”¨å®ƒä»¬æ¥å¤„ç†å¤æ‚æ¡ä»¶ã€‚

è¿™äº›æŠ€æœ¯æ˜¯æ•°æ®æ¸…æ´—å’Œé¢„å¤„ç†çš„å¼ºå¤§å·¥å…·,ä½¿ä½ èƒ½å¤Ÿé‡æ–°å¡‘é€ æ•°æ®ä»¥æ»¡è¶³åˆ†æéœ€æ±‚ã€‚

ä¸‹æ¬¡è§!